package com.demo.common.model;

import java.util.List;

import com.demo.common.model.base.BaseT1doRelation;
import com.demo.controller.TestController;
import com.jfinal.plugin.activerecord.Db;
import com.jfinal.plugin.activerecord.Record;

/**
 * Generated by JFinal.
 */
@SuppressWarnings("serial")
public class T1doRelation extends BaseT1doRelation<T1doRelation> {
	public static final T1doRelation dao = new T1doRelation().dao();
	/*
	 2019年2月12日 coco 注解：保存关联1do
	*/
	public static void saveRelation(String showId,String relationShowId,Integer SIMILARITY,Integer TYPE) {
		new T1doRelation().setShowId(showId).setRelationShowId(relationShowId).setTYPE(TYPE)
		.setSIMILARITY(SIMILARITY).save();
	}
	/*
	 2019年2月12日 coco 注解：修改关联1do
	 */
	public static void updateRelation(String showId,String relationShowId,Integer SIMILARITY) {
		Db.update("update t_1do_relation set SIMILARITY=? where SHOW_ID=? and RELATION_SHOW_ID=?",SIMILARITY,showId,relationShowId);
		Db.update("update t_1do_relation set SIMILARITY=? where SHOW_ID=? and RELATION_SHOW_ID=?",SIMILARITY,relationShowId,showId);
	}
	/*
	 2019年2月12日 coco 注解：//查询关联1do
	 */
	public static List<Record> selectRelation(String showId,String sql) {
		return Db.find("select  a.ID,a.SIMILARITY,b.SHOW_ID,a.TYPE,b.O_DESCRIBE from t_1do_relation a,t_1do_base b "
				+ "where (a.SIMILARITY>10 or a.TYPE=0) and a.RELATION_SHOW_ID=b.SHOW_ID and a.SHOW_ID=? "+sql+" ORDER BY a.SORT,a.SIMILARITY desc",showId);
	}
	/*
	 2019年2月14日 coco 注解：修改相似度
	*/
	public static void updateSimilarity(String SHOW_ID,String sql) {
		
			List<T1doLabel> list=T1doLabel.dao.find("select * from t_1do_label where SHOW_ID=?",SHOW_ID);
			List<T1doRelation> base1=dao.find("select * from t_1do_relation where SHOW_ID=? "+sql,SHOW_ID);
			base1.forEach(t1->{
				List<T1doLabel> list1=T1doLabel.dao.find("select * from t_1do_label where SHOW_ID=? ",t1.getRelationShowId());
				int result=TestController.getHashSet(list, list1);
				int i=list.size()>list1.size()?list.size():list1.size();
				int a=(int) ((double)(list.size()+list1.size()-result)/i*100);
				T1doRelation.updateRelation(SHOW_ID, t1.getRelationShowId(), a);				
			});
	}
}
